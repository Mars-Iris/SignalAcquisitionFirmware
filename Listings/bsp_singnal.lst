C51 COMPILER V9.56.0.0   BSP_SINGNAL                                                       10/29/2022 15:39:07 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE BSP_SINGNAL
OBJECT MODULE PLACED IN .\Objects\bsp_singnal.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Bsp\bsp_singnal.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\bsp_singnal.lst) TABS(2) OBJECT(.\Objects\bsp_singnal.obj)

line level    source

   1          
   2          #include  "./User/includes.h"
   3          
   4          
   5          //========================================================================
   6          // 函数: void BSP_GPIO_Init(void)
   7          // 描述: 初始化主板IO口.全部初始化为：上拉准双向口
   8          // 版本: V1.0, 2022-10-17
   9          //========================================================================
  10          void BSP_GPIO_Init(void)
  11          {
  12   1        GPIO_InitTypeDef  GPIO_InitStructure;       //结构定义
  13   1        
  14   1        GPIO_InitStructure.Pin  = GPIO_Pin_All;     //指定要初始化的IO, GPIO_Pin_0 ~ GPIO_Pin_7, 或操作
  15   1        GPIO_InitStructure.Mode = GPIO_OUT_PP;      //指定IO的输入或输出方式,GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,GPIO
             -_OUT_PP
  16   1        
  17   1        GPIO_Inilize(GPIO_P0,&GPIO_InitStructure);  //初始化GPIO_P0
  18   1        GPIO_Inilize(GPIO_P1,&GPIO_InitStructure);  //初始化GPIO_P1
  19   1        GPIO_Inilize(GPIO_P2,&GPIO_InitStructure);  //初始化GPIO_P2
  20   1        GPIO_Inilize(GPIO_P3,&GPIO_InitStructure);  //初始化GPIO_P3
  21   1        GPIO_Inilize(GPIO_P4,&GPIO_InitStructure);  //初始化GPIO_P4
  22   1      }
  23          //========================================================================
  24          // 函数: u8 BSP_GetGpioStatus(u8 pin)
  25          // 描述: 读取输入管脚电平值.此函数与硬件电路相关联
  26          // 参数: 板载输入口编号，取值D1--D32.
  27          // 返回: 输入口电平值.0或者1
  28          // 版本: V1.0, 2022-10-17
  29          //========================================================================
  30          static u8 BSP_GetGpioStatus(u8 pin)//查询对应的IO口状态
  31          {
  32   1        switch(pin)
  33   1        {
  34   2          case D1:    return(P00);
  35   2          case D2:    return(P01);
  36   2          case D3:    return(P02);
  37   2          case D4:    return(P03);
  38   2          case D5:    return(P04);
  39   2          case D6:    return(P05);
  40   2          case D7:    return(P06);
  41   2          case D8:    return(P07);
  42   2          case D9:    return(P27);
  43   2          case D10:   return(P26);
  44   2          case D11:   return(P25);
  45   2          case D12:   return(P24);
  46   2          case D13:   return(P23);
  47   2          case D14:   return(P22);
  48   2          case D15:   return(P21);
  49   2          case D16:   return(P20);
  50   2          case D17:   return(P10);
  51   2          case D18:   return(P11);
  52   2          case D19:   return(P12);
  53   2          case D20:   return(P13);
C51 COMPILER V9.56.0.0   BSP_SINGNAL                                                       10/29/2022 15:39:07 PAGE 2   

  54   2          case D21:   return(P14);
  55   2          case D22:   return(P15);
  56   2          case D23:   return(P16);
  57   2          case D24:   return(P17);
  58   2          case D25:   return(P32);
  59   2          case D26:   return(P33);
  60   2          case D27:   return(P34);
  61   2          case D28:   return(P35);
  62   2          case D29:   return(P36);
  63   2          case D30:   return(P37); 
  64   2          case D31:   return(P47);
  65   2          case D32:   return(P46);
  66   2          case D33:   return(P45);
  67   2          case D34:   return(P44); 
  68   2          case D35:   return(P44);
  69   2          default: 
  70   2                      return(0);
  71   2        }
  72   1      }
  73          //========================================================================
  74          // 函数: u8 BSP_ReadInputDataBit(SignalTypeDef *pSignal)
  75          // 描述: 读取输入管脚电平值.
  76          // 参数: SignalTypeDef为指向信号结构体的指针.
  77          // 返回: 返回TURE，或FALSE.
  78          // 版本: V1.0, 2022-10-17
  79          //========================================================================
  80          u8 BSP_ReadInputDataBit(SignalTypeDef *pSignal)
  81          {
  82   1        static u8 flag = 0;
  83   1        u8 status = 0;
  84   1        u8 signalstatus = BSP_GetGpioStatus(pSignal->pin);//获取单片机的管脚输入状态
  85   1        if(flag == 0)
  86   1        {
  87   2          if (signalstatus == pSignal->modle)//判断信号是否开启
  88   2          {
  89   3            pSignal->times = 0;
  90   3            status = TURE;
  91   3          }
  92   2          else if(pSignal->times < pSignal->rising_ed) //信号抖动与延时处理
  93   2          {
  94   3            pSignal->times++;
  95   3            status = TURE;
  96   3          } 
  97   2          else 
  98   2          {
  99   3            flag = 1;
 100   3            status = FLASE; 
 101   3          }
 102   2        }
 103   1        else 
 104   1        {
 105   2          if (signalstatus != pSignal->modle)//获取相应的状态
 106   2          {
 107   3            pSignal->times = 0;
 108   3            status = FLASE;
 109   3          }
 110   2          else if(pSignal->times < pSignal->falling_ed) //信号抖动与延时处理
 111   2          {
 112   3            pSignal->times++;
 113   3            status = FLASE;
 114   3          } 
 115   2          else 
C51 COMPILER V9.56.0.0   BSP_SINGNAL                                                       10/29/2022 15:39:07 PAGE 3   

 116   2          {
 117   3            flag = 0;
 118   3            status = TURE; 
 119   3          }   
 120   2        }
 121   1        return(status);
 122   1      }
 123          
 124          
 125          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    457    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
